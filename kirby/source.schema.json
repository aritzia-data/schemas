{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "https://acme.com/source.schema.json",
    "title": "Source",
    "description": "A Kirby data source",
    "type": "object",
    "properties": {
        "type": {
            "type": "string",
            "description": "The type of source",
            "enum": [
                "externalPush",
                "scheduledJob",
                "googleSheet"
            ]
        }
    },
    "anyOf": [
        {
            "$ref": "#/$defs/externalPushSource"
        },
        {
            "$ref": "#/$defs/scheduledJobSource"
        },
        {
            "$ref": "#/$defs/googleSheetSource"
        }
    ],
    "$defs": {
        "authenticationType": {
            "title": "Source authentication type",
            "type": "object",
            "properties": {
                "authType": {
                    "type": "string",
                    "description": "The type of authentication used",
                    "default": "basic_auth"
                },
                "authHeader": {
                    "type": "string",
                    "description": "The header used for authentication",
                    "default": "Authorization"
                }
            },
            "additionalProperties": false
        },
        "externalPushSource": {
            "title": "External push source",
            "type": "object",
            "properties": {
                "type": {
                    "const": "externalPush"
                },
                "authentication": {
                    "$ref": "#/$defs/authenticationType"
                },
                "isSLT": {
                    "type": "boolean",
                    "description": "If the source is an SLT source"
                }
            },
            "required": [
                "type",
                "isSLT"
            ],
            "additionalProperties": false
        },
        "scheduledJobSource": {
            "title": "Scheduled job source",
            "type": "object",
            "properties": {
                "type": {
                    "const": "scheduledJob"
                },
                "authentication": {
                    "$ref": "#/$defs/authenticationType"
                },
                "frequency": {
                    "type": "string",
                    "description": "The frequency of the scheduled job source, as a cron expression",
                    "$comment": "Supports JavaScript/ECMAScript for validators. Taken from https://regex101.com/library/seQ41r and backslash escaped.",
                    "pattern": "^(((\\d+,)+\\d+|((\\d+|[*])[/]\\d+|((JAN|FEB|APR|MA[RY]|JU[LN]|AUG|SEP|OCT|NOV|DEC)(-(JAN|FEB|APR|MA[RY]|JU[LN]|AUG|SEP|OCT|NOV|DEC))?))|(\\d+-\\d+)|\\d+(-\\d+)?[/]\\d+(-\\d+)?|\\d+|[*]|(MON|TUE|WED|THU|FRI|SAT|SUN)(-(MON|TUE|WED|THU|FRI|SAT|SUN))?) ?){5}$"
                },
                "batchSize": {
                    "type": "integer",
                    "description": "The size of scheduled job source batch",
                    "default": 1
                },
                "load": {
                    "type": "string",
                    "description": "The load type of the scheduled job source",
                    "enum": [
                        "full",
                        "delta"
                    ],
                    "default": "delta"
                },
                "ignoreQueryTimestamp": {
                    "type": "boolean",
                    "description": "If the query timestamp of the scheduled job source should be ignored",
                    "default": false
                }
            },
            "required": [
                "type",
                "frequency"
            ],
            "additionalProperties": false
        },
        "googleSheetSource": {
            "title": "Google Sheet source",
            "type": "object",
            "properties": {
                "type": {
                    "const": "googleSheet"
                },
                "authentication": {
                    "$ref": "#/$defs/authenticationType"
                },
                "filePath": {
                    "type": "string",
                    "description": "The path of the Google Sheet (https://drive.google.com/open?id=...)",
                    "pattern": "^https:\\/\\/drive\\.google\\.com\\/open\\?id=[a-zA-Z0-9-_]+$"
                },
                "range": {
                    "type": "string",
                    "description": "The range within the Google Sheet (sheet_name!top_left_cell_id:bottom_right_cell_id)",
                    "default": null,
                    "pattern": "^\\w+![A-Z]+[0-9]+:[A-Z]+[0-9]+$"
                },
                "skipLeadingRows": {
                    "type": "integer",
                    "description": "The number of rows to skip at the top of the Google Sheet",
                    "default": 1
                }
            },
            "required": [
                "type",
                "filePath"
            ],
            "additionalProperties": false
        }
    }
}